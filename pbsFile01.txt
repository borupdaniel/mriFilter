# LAUNCH FILE FOR MPFILTER
# Daniele Schiavazzi - 2012
# =========================
#!/bin/bash
#
# --------
# JOB NAME
# --------
#
# job name (default is name of pbs script file)
#PBS -N MPFILTER
#
# -------------
# JOB RESOURCES
# -------------
#
# resource limits: number of CPUs to be used
#PBS -l nodes=1
#
# resource limits: amount of memory to be used
#PBS -l ppn=12
#
# resource limits: max. wall clock time during which job can be running
#PBS -l walltime=500:00:00
#
# -----------
# JOB OUTPUTS
# -----------
#
# path/filename for standard output
#PBS -o mpfilter.out
#
# path/filename for standard error
#PBS -e mpfilter.err
#
# --------------------
# JOB QUEUE AND GROUPS
# --------------------
#
# queue name, one of {default, special express}
# The default queue, "default", need not be specified
#PBS -q default
#
# ---------------
# JOB INTERACTION
# ---------------
#
# Send message when job begins, ends, aborts
#PBS -mbea
#
# do not rerun this job if it fails
#PBS -r n
#
# export all my environment variables to the job
#PBS -V
#
# -----------------
# STANFORD SETTINGS
# -----------------

PBS_O_WORKDIR='/home/danschi/mpfilter/data'
         export PBS_O_WORKDIR

### ---------------------------------------
### BEGINNING OF EXECUTION
### ---------------------------------------

echo The master node of this job is `hostname`
echo The working directory is `echo $PBS_O_WORKDIR`
echo This job runs on the following nodes:
echo `cat $PBS_NODEFILE`

### end of information preamble

cd $PBS_O_WORKDIR
cmd="../code/mpfilter -s SeqFile.txt filtered"
echo "Running MPIEXEC with: $cmd in directory "`pwd`
$cmd >& $PBS_O_WORKDIR/log.mpfilter

###
# Using PBS - Environment Variables
# When a batch job starts execution, a number of environment variables are
# predefined, which include:
#
#      Variables defined on the execution host.
#      Variables exported from the submission host with
#                -v (selected variables) and -V (all variables).
#      Variables defined by PBS.
#
# The following reflect the environment where the user ran qsub:
# PBS_O_HOST    The host where you ran the qsub command.
# PBS_O_LOGNAME Your user ID where you ran qsub.
# PBS_O_HOME    Your home directory where you ran qsub.
# PBS_O_WORKDIR The working directory where you ran qsub.
#
# These reflect the environment where the job is executing:
# PBS_ENVIRONMENT       Set to PBS_BATCH to indicate the job is a batch job, or
#                 to PBS_INTERACTIVE to indicate the job is a PBS interactive job.
# PBS_O_QUEUE   The original queue you submitted to.
# PBS_QUEUE     The queue the job is executing from.
# PBS_JOBID     The job's PBS identifier.
# PBS_JOBNAME   The job's name.
###